<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.green.ebook.dao.AdminDao">

<!-- 작품내용을 저장해 놓음 -->
  <select id="toonList" resultType="kr.green.ebook.vo.ToonVo">
		select * from toon
			where 1=1
			<if test="cri.type==0">
  				and (title like concat('%',#{cri.search},'%')
  					or artist like concat('%',#{cri.search},'%')
  					or lastEpisode like concat('%',#{cri.search},'%'))
  			</if>
  			<if test="cri.type==1">
  				and title like concat('%',#{cri.search},'%')
  			</if>
  			<if test="cri.type==2">
  				and artist like concat('%',#{cri.search},'%')
  			</if>
  			<if test="cri.type==3">
  				and lastEpisode like concat('%',#{cri.search},'%')
  			</if>
  			order by t_num desc
  			limit #{cri.startPage},#{cri.perPageNum}
  </select>
 <!-- 작품페이지네이션 -->
    <select id="getTotalCountByToon" resultType="int">
		select count(*) from toon
			where 1=1
  			<if test="cri.type==1">
  				and (title like concat('%',#{cri.search},'%')
  					or artist like concat('%',#{cri.search},'%')
  					or lastEpisode like concat('%',#{cri.search},'%'))
  			</if>
  			<if test="cri.type==2">
  				and title like concat('%',#{cri.search},'%')
  			</if>
  			<if test="cri.type==3">
  				and artist like concat('%',#{cri.search},'%')
  			</if>
  			<if test="cri.type==4">
  				and lastEpisode like concat('%',#{cri.search},'%')
  			</if>
  			
  </select>

 <!-- 번호작품 -->
<select id="getToon" resultType="kr.green.ebook.vo.ToonVo">
		select * from toon where t_num = #{num}
</select>
 <!-- 번호작품 -->
<select id="getToont" resultType="kr.green.ebook.vo.ToonVo">
		select * from toon where t_title = #{Title}
</select>
<!-- 작품 등록 -->
	<insert id="insertToon">
		insert into
			toon(title,t_title,artist,plot,t_img,t_week,t_type,t_typify)
			values(#{toon.title},#{toon.t_title},#{toon.artist},#{toon.plot},#{toon.t_img},#{toon.t_week},#{toon.t_type},#{toon.t_typify})
	</insert>
<!-- 작품 수정 및 업데이트 -->	
	<update id="updateToon">
		update toon
			set
				title = #{toon.title},
				t_title = #{toon.t_title},
				artist = #{toon.artist},
				plot = #{toon.plot},
				t_img = #{toon.t_img},
				t_typify = #{toon.t_typify},
				t_week = #{toon.t_week},
				t_type = #{toon.t_type},
				t_views = #{toon.t_views},
				lastEpisode = #{toon.lastEpisode},
				choice = #{toon.choice},
				up = #{toon.up}
			where
				t_title = #{toon.t_title}
	</update>
<!-- 연재 등록 -->
	<insert id="insertEp">
		insert into
			episode(e_t_title,e_edition,e_title,e_img,e_coin)
			values(#{ep.e_t_title},#{ep.e_edition},#{ep.e_title},#{ep.e_img},#{ep.e_coin})
	</insert>

<!-- 요일 -->
	<select id="weekList" resultType="kr.green.ebook.vo.ToonVo">
		select * from toon where t_week   			
	</select>
<!-- 요일(영어) 선택 -->
	<select id="getWeek" resultType="kr.green.ebook.vo.WeekVo"> 
		select * from week where w_code = #{t_week} 
	</select>
<!-- 장르 선택  -->
	<select id="toonType">
		select * from toon where t_type
	</select>
	
	<!-- 연재불러오기 -->
	<select id="getEpList" resultType="kr.green.ebook.vo.EpisodeVo"> 
		SELECT * FROM episode 
			join (SELECT * FROM toon where t_title like #{Title}) as at
			on e_t_title = t_title
			where e_img like concat('%',#{edition},'%');
	</select>
	<!-- 연재 대표이미지 -->
	<select id="getEp" resultType="kr.green.ebook.vo.EpisodeVo">
		select * from episode
			join (SELECT * FROM toon where t_title like #{Title}) as t
			on e_t_title = t_title
			where e_img like '%cover%' and e_edition = #{edition}
	</select>
		<select id="getEpcoverlist" resultType="kr.green.ebook.vo.EpisodeVo">
		select * from episode
			join (SELECT * FROM toon where t_title like #{Title}) as t
			on e_t_title = t_title
			where e_img like '%cover%'
	</select>
	
<!-- 연재댓글 가져오기 -->
	<select id="getCmtList" resultType="kr.green.ebook.vo.EpcommentVo">
		select * from epcomment
			join (SELECT * FROM toon where t_title like #{Title}) as st
			on co_epTitle = t_title
			where co_epEdition like #{edition}
			order by co_num desc
	</select>
	
<!-- 댓글 등록 -->
	<insert id="insertEpcmt">
		insert into
			epcomment(co_content,co_member,co_epTitle,co_epEdition)
			values(#{epcmt.co_content},#{epcmt.co_member},#{epcmt.co_epTitle},#{epcmt.co_epEdition})
	</insert>
<!-- 찜하기 기능 -->
	<select id="getChoice" resultType="kr.green.ebook.vo.ChoiceVo">
		SELECT * FROM choice where ch_title = #{Title} and ch_id = #{id}
	</select>
	<select id="selectChoice" resultType="int">
		select count(*) from choice where ch_title =#{Title} and ch_id = #{id}
	</select>
	<insert id="insertChoice">
		insert into
			choice(ch_title,ch_id)
			values(#{Title},#{id})
	</insert>
	<update id="updateToonByChoice">
		update toon
		set
			choice = (select count(*) from choice where ch_title = #{Title})
		where t_title = #{Title}
	</update>
	<!-- 찜 삭제 -->
	<delete id="deleteChoice">
	DELETE FROM choice where ch_title =#{Title} and ch_id = #{id}
	</delete>

<!-- 전체 이벤트 불러오기 -->
	<select id="eventList" resultType="kr.green.ebook.vo.BookeventVo">
		select * from bookevent
	</select>
<!-- 이벤트 등록 -->
	<insert id="insertEvent">
		insert into
			bookevent(ev_title,ev_engtitle,ev_img,ev_t_title,ev_member,ev_banner)
			values(#{event.ev_title},#{event.ev_engtitle},#{event.ev_img},#{event.ev_t_title},#{event.ev_member},#{event.ev_banner})
	</insert>
<!-- 전체 충전 리스트 -->
	<select id="payList" resultType="kr.green.ebook.vo.PayVo">
		select * from pay
	</select>
<!-- 충전용 배너 -->
	<select id="paybanner" resultType="kr.green.ebook.vo.BookeventVo">
		select * from bookevent where ev_engtitle = 'pay'
	</select>
<!-- 충전하기/사용하기 -->
	<insert id="insertPay">
		insert into
		pay(p_member,p_price,p_coin,p_point,p_title,p_edition,p_usedate,p_charging,p_one)
		values(#{pay.p_member},#{pay.p_price},#{pay.p_coin},#{pay.p_point},#{pay.p_title},#{pay.p_edition},#{pay.p_usedate},#{pay.p_charging},#{pay.p_one})
	</insert>
<!-- 결제내역 -->
	<select id="getPayList" resultType="kr.green.ebook.vo.PayVo">
		select * from pay where p_member =#{name}
	</select>
<!-- 전체문의내역 --> 
	<select id="getClaim" resultType="kr.green.ebook.vo.ClaimVo"> 
		select * from claim 
	</select>
</mapper>