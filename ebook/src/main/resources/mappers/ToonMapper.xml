<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.green.ebook.dao.AdminDao">

<!-- 작품내용을 저장해 놓음 -->
  <select id="toonList" resultType="kr.green.ebook.vo.ToonVo">
		select * from toon
			where 1=1
			<if test="cri.type==0">
  				and (title like concat('%',#{cri.search},'%')
  					or artist like concat('%',#{cri.search},'%')
  					or lastEpisode like concat('%',#{cri.search},'%'))
  			</if>
  			<if test="cri.type==1">
  				and title like concat('%',#{cri.search},'%')
  			</if>
  			<if test="cri.type==2">
  				and artist like concat('%',#{cri.search},'%')
  			</if>
  			<if test="cri.type==3">
  				and lastEpisode like concat('%',#{cri.search},'%')
  			</if>
  			order by t_num desc
  			limit #{cri.startPage},#{cri.perPageNum}
  </select>
 <!-- 작품페이지네이션 -->
    <select id="getTotalCountByToon" resultType="int">
		select count(*) from toon
			where 1=1
  			<if test="cri.type==1">
  				and (title like concat('%',#{cri.search},'%')
  					or artist like concat('%',#{cri.search},'%')
  					or lastEpisode like concat('%',#{cri.search},'%'))
  			</if>
  			<if test="cri.type==2">
  				and title like concat('%',#{cri.search},'%')
  			</if>
  			<if test="cri.type==3">
  				and artist like concat('%',#{cri.search},'%')
  			</if>
  			<if test="cri.type==4">
  				and lastEpisode like concat('%',#{cri.search},'%')
  			</if>
  			
  </select>

 <!-- 번호작품 -->
<select id="getToon" resultType="kr.green.ebook.vo.ToonVo">
		select * from toon where t_num = #{num}
</select>
 <!-- 번호작품 -->
<select id="getToont" resultType="kr.green.ebook.vo.ToonVo">
		select * from toon where t_title = #{Title}
</select>
<!-- 작품 등록 -->
	<insert id="insertToon">
		insert into
			toon(title,t_title,artist,plot,t_img,t_week,t_type,t_typify)
			values(#{toon.title},#{toon.t_title},#{toon.artist},#{toon.plot},#{toon.t_img},#{toon.t_week},#{toon.t_type},#{toon.t_typify})
	</insert>
<!-- 작품 수정 및 업데이트 -->	
	<update id="updateToon">
		update toon
			set
				title = #{toon.title},
				t_title = #{toon.t_title},
				artist = #{toon.artist},
				plot = #{toon.plot},
				t_img = #{toon.t_img},
				t_typify = #{toon.t_typify},
				t_week = #{toon.t_week},
				t_type = #{toon.t_type},
				t_views = #{toon.t_views},
				lastEpisode = #{toon.lastEpisode},
				choice = #{toon.choice},
				up = #{toon.up}
			where
				t_title = #{toon.t_title}
	</update>
<!-- 연재 등록 -->
	<insert id="insertEp">
		insert into
			episode(e_t_title,e_edition,e_title,e_img,e_coin)
			values(#{ep.e_t_title},#{ep.e_edition},#{ep.e_title},#{ep.e_img},#{ep.e_coin})
	</insert>

<!-- 요일 -->
	<select id="weekList" resultType="kr.green.ebook.vo.ToonVo">
		select * from toon where t_week   			
	</select>
<!-- 요일(영어) 선택 -->
	<select id="getWeek" resultType="kr.green.ebook.vo.WeekVo"> 
		select * from week where w_code = #{t_week} 
	</select>
<!-- 장르 선택  -->
	<select id="toonType">
		select * from toon where t_type
	</select>
	
	<!-- 연재불러오기 -->
	<select id="getEpList" resultType="kr.green.ebook.vo.EpisodeVo"> 
		SELECT * FROM episode 
			join (SELECT * FROM toon where t_title like #{title}) as at
			on e_t_title = title
			where e_img like concat('%',#{edition},'%');
	</select>
	<!-- 연재 대표이미지 -->
	<select id="getEpcover" resultType="kr.green.ebook.vo.EpisodeVo">
		select * from episode
			join (SELECT * FROM toon where title like #{title}) as t
			on e_t_title = title
			where e_img like '%cover%'
	</select>
</mapper>